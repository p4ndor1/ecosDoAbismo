<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="page-category" content="crimes">
    <title>Título do Post // ECOS DO ABISMO</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jacquard+12&family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="scanlines"></div>

    <div class="interface-container">
        <header class="main-header border-double">
            <div class="header-meta">
                <span>VOL. 666</span>
                <span>LEITURA.EXE</span> </div>
            <h1 class="glitch-title"><a href="index.html" style="color:inherit; text-decoration:none;">Ecos do Abismo</a></h1>
            <div class="header-meta">
                <span>SAO.PAULO</span>
                <span>[REC]</span>
            </div>
        </header>

        <nav class="main-nav border-simple">
            <a href="index.html" class="nav-item">:: INÍCIO</a> <a href="#" class="nav-item">:: BIBLIOTECA</a>
            <a href="pages/crimes.html" class="nav-item">:: CRIMES REAIS</a>
            <a href="pages/darkweb.html" class="nav-item">:: DARK WEB</a>
            <a href="pages/assombrações.html" class="nav-item">:: ASSOMBRAÇÕES</a>
        </nav>

        <main class="main-content">
            <aside class="sidebar border-simple">
                <div class="ad-placeholder">
                    <span>[ ESPAÇO PUBLICITÁRIO ]</span>
                    <small>Google Adsense</small>
                </div>
                <div class="ad-placeholder skyscraper">
                    <span>[ ESPAÇO PUBLICITÁRIO ]</span>
                    <small>Vertical</small>
                </div>
                <div id="recent-posts-sidebar" style="margin-top: 30px;">
                 </div>
            </aside>
            <article class="hero-section border-simple" style="display: block; text-align: left;">
                
                <header class="post-header">
                    <p class="separator">ARQUIVO: #001 // CATEGORIA: NOME_DA_CATEGORIA</p>
                    <h1 class="gothic-sub">O Título Assustador Vem Aqui</h1>
                    <p class="header-meta" style="flex-direction: row; justify-content: flex-start; gap: 10px;">
                        <span>DATA: 26.11.2025</span> | <span>AUTOR: DESCONHECIDO</span>
                    </p>
                    <div class="separator">-----------------------------</div>
                </header>

                <figure class="post-feature-image">
                    <img src="https://placehold.co/800x400/3B2E25/C8CDB9?text=EVIDENCIA_VISUAL" alt="Descrição da imagem assustadora">
                    <figcaption>FIG. 1: Registro visual recuperado dos arquivos.</figcaption>
                </figure>
                <div class="separator">-----------------------------</div>

                <div class="post-body terminal-text">
                    <p>Aqui começa o texto do seu conto ou relato...</p>
                    <p>Observe a imagem acima. Ela retrata o exato momento em que o fenômeno ocorreu.</p>
                    
                    <h3>Subtítulos ficam assim</h3>
                    <p>Mais texto aterrorizante...</p>
                </div>

                <div class="separator" style="margin-top: 30px;">-----------------------------</div>

                <div class="comments-section border-simple" style="margin-top: 40px; padding: 20px;">
    <h3 class="gothic-sub" style="font-size: 2rem;">Registros da Comunidade</h3>
    
    <div id="comments-list" class="terminal-text">
        <p>Carregando transmissões...</p>
    </div>

    <div class="separator">-----------------------------</div>

    <form id="comment-form" class="retro-form" style="flex-direction: column;">
        <input type="text" id="user-name" placeholder="CODENAME // SEU NOME" required style="width: 100%;">
        <textarea id="user-msg" rows="3" placeholder="MENSAGEM CRIPTOGRAFADA..." required 
            style="width: 100%; background: transparent; border: 2px solid var(--dim-color); color: var(--main-color); font-family: var(--font-term); padding: 10px; margin-top: 10px;"></textarea>
        <button type="submit" style="margin-top: 10px;">ENVIAR TRANSMISSÃO</button>
    </form>
</div>

<script type="module">
    // Importa nosso arquivo de configuração
    import { db, collection, addDoc, getDocs, orderBy, query } from './firebase-config.js';

    const form = document.getElementById('comment-form');
    const commentsList = document.getElementById('comments-list');
    
    // Pegar o ID ou Nome do post atual (para não misturar comentários de posts diferentes)
    // Por enquanto vamos usar o titulo da pagina como ID
    const postID = document.title; 

    // FUNÇÃO 1: Carregar Comentários
    async function loadComments() {
        commentsList.innerHTML = "<p>Buscando sinais...</p>";
        
        // Busca na coleção 'comentarios'
        const q = query(collection(db, "comentarios"), orderBy("data", "desc"));
        const querySnapshot = await getDocs(q);
        
        commentsList.innerHTML = ""; // Limpa a lista

        querySnapshot.forEach((doc) => {
            const data = doc.data();
            // Só mostra se for deste post
            if(data.postReferencia === postID) {
                const div = document.createElement('div');
                div.style.marginBottom = "15px";
                div.style.borderBottom = "1px dashed var(--dim-color)";
                div.innerHTML = `
                    <strong style="color: var(--dim-color);">> ${data.nome}</strong> 
                    <span style="font-size: 0.8rem">(${new Date(data.data.seconds * 1000).toLocaleDateString()})</span><br>
                    <span style="display:block; padding-left: 15px;">${data.mensagem}</span>
                `;
                commentsList.appendChild(div);
            }
        });

        if(commentsList.innerHTML === "") {
            commentsList.innerHTML = "<p>Nenhum sinal detectado neste setor.</p>";
        }
    }

    // FUNÇÃO 2: Enviar Comentário
    form.addEventListener('submit', async (e) => {
        e.preventDefault(); // Não recarrega a página
        
        const nome = document.getElementById('user-name').value;
        const msg = document.getElementById('user-msg').value;

        try {
            await addDoc(collection(db, "comentarios"), {
                nome: nome,
                mensagem: msg,
                postReferencia: postID,
                data: new Date()
            });
            
            form.reset();
            loadComments(); // Recarrega a lista
            alert("Transmissão enviada com sucesso.");
        } catch (e) {
            console.error("Erro ao enviar: ", e);
            alert("Erro na transmissão. O sistema falhou.");
        }
    });

    // Carrega ao abrir a página
    loadComments();
</script>
                
                <a href="index.html" class="btn-retro" style="font-size: 1.2rem;">&lt; VOLTAR AO MENU</a>
            </article>

        </main>

        <footer class="main-footer border-double">
            <div class="footer-logo">ECOS_DO_ABISMO © 2025</div>
        </footer>
    </div>
    <script src="db.js"></script>
    <script src="script.js"></script>
</body>
</html>